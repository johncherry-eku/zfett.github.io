<!DOCTYPE html>
<html lang="en-us">
<head>
	<title></title>
	<meta charset="utf-8">
	<script src="libs/jquery.min.js"></script>
</head>

<body>
	<script>
		var audio = document.querySelector('audio');
		
		var assetURL = 'media/test.mp3';
		var mimeCodec = 'audio/mpeg; codecs="mp3"';
		
		if ('MediaSource' in window && MediaSource.isTypeSupported(mimeCodec)) {
			var mediaSource = new MediaSource();
			//console.log(mediaSource.readyState); // closed
			audio.src = URL.createObjectURL(mediaSource);
			mediaSource.addEventListener('sourceopen', sourceOpen);
		} else {
			console.error('Unsupported MIME type or codec: ', mimeCodec);
		}
		
		function sourceOpen (_) {
			//console.log(this.readyState); // open
			var mediaSource = this;
			var sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);
			fetchAB(assetURL, function (buf) {
				sourceBuffer.addEventListener('updateend', function (_) {
					mediaSource.endOfStream();
					audio.play();
					//console.log(mediaSource.readyState); // ended
				});
				sourceBuffer.appendBuffer(buf);
			});
		};
		
		function fetchAB (url, cb) {
			console.log(url);
			var xhr = new XMLHttpRequest;
			xhr.open('get', url);
			xhr.responseType = 'arraybuffer';
			xhr.onload = function () {
				cb(xhr.response);
			};
			xhr.send();
		};
	</script>
	<audio>
	</audio>
</body>
</html>